@page "/"
@using Telerik.ReportViewer.Blazor

@* Important: prerender the ReportViewer *@
@rendermode InteractiveServer

<environment include="Development">
    <script src="https://localhost:7443/reports/resources/js/telerikReportViewer"></script>
</environment>

<environment include="Staging,Production">
    <script src="@(Environment.GetEnvironmentVariable("services__apiservice__https__0"))/reports/resources/js/telerikReportViewer"></script>
</environment>

<style>
    #rv1 {
        position: relative;
        width: 800px;
        height: 1200px;
    }
</style>

@* Important: Viewer's resources are dynamically loaded in OnAfterRenderAsync because I don't know the base URL yet *@
<ReportViewer @ref="ReportViewer1"
              ViewerId="rv1"
              ServiceUrl="@ApiServiceUrl"
              ReportSource="@MyReportSource"
              ScaleMode="@(ScaleMode.Specific)"
              Scale="1.0" />

@code {
    private string? ApiServiceUrl { get; set; }
    private ReportViewer? ReportViewer1 { get; set; }
    private ReportSourceOptions MyReportSource { get; set; } = new() { Report = "Barcodes Report.trdp" };

    protected override async Task OnInitializedAsync()
    {
        Console.WriteLine($"service : {Environment.GetEnvironmentVariable("services__apiservice__https__0")}");

        var rootUrl = "";
#if DEBUG
        rootUrl = "https://localhost:7443";
#elif RELEASE
        rootUrl = Environment.GetEnvironmentVariable("services__apiservice__https__0");
#endif
        this.ApiServiceUrl = $"{rootUrl}/reports";

        await base.OnInitializedAsync();
    }
}